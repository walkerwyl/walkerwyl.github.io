---
laout: post
title: 初识Shell程序
published: true
date: 2021-09-06
author: walkerwyl
tags:
  - Shell
---


## 学习目标

1. 编译型语言与解释型语言的差异，Linux Shell编程的优势。
2. 如何编写和运行Linux Shell程序。
3. Linux Shell运行在环境变量中，环境变量的设置。

```shell
# 涉及到的命令
sh
bash
echo
pwd
chmod
source
rm
more
set
unset
export
env
```

## 第一个Shell程序

从一个基本的Shell程序了解基本构成以及程序运行方法。修改文件权限为可执行（chmod +x echo.sh）

```shell
#!/bin/sh
# echo.sh
cd tmp
echo "Hello world"
```

程序运行结果，命令行输出"Hello world"，当前的工作目录没有改变。

第一行的#!（she bang）
命令行Shell执行程序时，首先判断是否程序有执行程序。Shell执行命令且判定文件具有执行权限后，调用Linux内核命令新建（fork）一个进程，在新建的进程中调用指定的命令。
由于echo.sh是文本文件，内核不能直接执行。GNU/Linux系统通常存在多个Shell，第一行指定由/bin/sh执行此脚本。因此，Shell创建了一个/bin/sh（标准Shell）进程来执行脚本。
命令行读取第一行的#!时，读取其后的字符，尝试寻找解释器的完整路径，参数也一并读取。
例如"#!/bin/bash -l"，Shell会启用一个新的bash进程执行程序。-l参数使得该bash进程的反应与登录Shell相似。

```shell
#!/bin/rm
# 自删除脚本,运行后删除该脚本
WHATEVER=45
echo "This line will never print!"
# 脚本不会执行到这里退出
exit ${WHATEVER}
```

## 程序运行方式

1. 修改文件权限为可执行，直接运行文件（chmod +x echo.sh;./echo.sh）
2. 直接调用命令解释器执行程序（bash echo.sh）
3. 使用source执行文件（source echo.sh，与前两者不同）

程序执行的差异
1. #!中指定的Shell解释器和第二种指定的Shell解释器相同的话，两种执行效果相同。
2. 调用source执行echo.sh，结果当前目录发生改变。

## Shell的命令种类

GNU/Linux Shell可执行的命令共3种：内建命令、Shell函数和外部命令。

1. **内建命令**：Shell程序本身包含的命令，集成在Shell解释器中。例如，几乎所有Shell解释器包含cd内建命令来改变工作目录。部分内建命令用于改变Shell本身的属性设置。执行内建命令时，没有进程的创建和消亡；另一部分内建命令是I/O命令，例如echo命令。
2. **Shell函数**：一系列程序代码，相互关联的Shell命令组成。
3. **外部命令**：独立于Shell的可执行程序。（独立，不受Shell版本影响，执行结果一致）例如：find、grep、echo.sh。命令行在执行外部命令时，创建一个当前Shell的复制进程来执行。存在进程的创建和消亡。